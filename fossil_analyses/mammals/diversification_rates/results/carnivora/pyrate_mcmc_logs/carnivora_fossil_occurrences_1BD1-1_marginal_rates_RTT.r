# 1 files combined:
# 	./carnivora_fossil_occurrences_1BD1-1_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./carnivora_fossil_occurrences_1BD1-1_marginal_rates_RTT.pdf',width=0.6*9, height=0.6*21)
par(mfrow=c(3,1))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
	N=100
	beta=(1:(N-1))/N
	alpha_shape=0.25
	cat=1-(beta^(1./alpha_shape))
	for (i in 1:(N-1)){
		trans= 1/N + 2/N
		polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
	}
	lines(rev(age), rev(mean_m), col = color, lwd=3)
}
	
L_hpd_m95=c(0.475830221931, 0.475830221931,0.475830221931,0.394247776791,0.394247776791,0.394247776791,0.263620144808,0.263620144808,0.263620144808,0.263620144808,0.263620144808,0.263620144808,0.263620144808,0.263620144808,0.263620144808,0.263620144808,0.263620144808,0.263620144808,0.263620144808,0.263620144808,0.263620144808,0.263620144808,0.263620144808,0.263620144808,0.236637737395,0.236637737395,0.236637737395,0.236637737395,0.236637737395,0.236637737395,0.236637737395,0.236637737395,0.236637737395,0.236637737395,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.272476825543,0.181549725338,0.181549725338,0.181549725338,0.181549725338,0.181549725338,0.181549725338,0.181549725338)
L_hpd_M95=c(0.598836015288, 0.598836015288,0.598836015288,0.533701228435,0.533701228435,0.533701228435,0.302845725448,0.302845725448,0.302845725448,0.302845725448,0.302845725448,0.302845725448,0.302845725448,0.302845725448,0.302845725448,0.302845725448,0.302845725448,0.302845725448,0.302845725448,0.302845725448,0.302845725448,0.302845725448,0.302845725448,0.302845725448,0.339871722029,0.339871722029,0.339871722029,0.339871722029,0.339871722029,0.339871722029,0.339871722029,0.339871722029,0.339871722029,0.339871722029,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.448501098354,0.823831107846,0.823831107846,0.823831107846,0.823831107846,0.823831107846,0.823831107846,0.823831107846)
M_hpd_m95=c(0.515885348202, 0.515885348202,0.515885348202,0.332886105995,0.332886105995,0.332886105995,0.234975179084,0.234975179084,0.234975179084,0.234975179084,0.234975179084,0.234975179084,0.234975179084,0.234975179084,0.234975179084,0.234975179084,0.234975179084,0.234975179084,0.234975179084,0.234975179084,0.234975179084,0.234975179084,0.234975179084,0.234975179084,0.145985690962,0.145985690962,0.145985690962,0.145985690962,0.145985690962,0.145985690962,0.145985690962,0.145985690962,0.145985690962,0.145985690962,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.186977932096,0.0745005367712,0.0745005367712,0.0745005367712,0.0745005367712,0.0745005367712,0.0745005367712,0.0745005367712)
M_hpd_M95=c(0.64297788504, 0.64297788504,0.64297788504,0.462679342071,0.462679342071,0.462679342071,0.271444427765,0.271444427765,0.271444427765,0.271444427765,0.271444427765,0.271444427765,0.271444427765,0.271444427765,0.271444427765,0.271444427765,0.271444427765,0.271444427765,0.271444427765,0.271444427765,0.271444427765,0.271444427765,0.271444427765,0.271444427765,0.224448952222,0.224448952222,0.224448952222,0.224448952222,0.224448952222,0.224448952222,0.224448952222,0.224448952222,0.224448952222,0.224448952222,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.335868101131,0.481828584974,0.481828584974,0.481828584974,0.481828584974,0.481828584974,0.481828584974,0.481828584974)
R_hpd_m95=c(-0.134907890225, -0.134907890225,-0.134907890225,-0.0288400858513,-0.0288400858513,-0.0288400858513,0.00199940153594,0.00199940153594,0.00199940153594,0.00199940153594,0.00199940153594,0.00199940153594,0.00199940153594,0.00199940153594,0.00199940153594,0.00199940153594,0.00199940153594,0.00199940153594,0.00199940153594,0.00199940153594,0.00199940153594,0.00199940153594,0.00199940153594,0.00199940153594,0.0461665535826,0.0461665535826,0.0461665535826,0.0461665535826,0.0461665535826,0.0461665535826,0.0461665535826,0.0461665535826,0.0461665535826,0.0461665535826,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.0248390279153,-0.098780346276,-0.098780346276,-0.098780346276,-0.098780346276,-0.098780346276,-0.098780346276,-0.098780346276)
R_hpd_M95=c(0.0342252912802, 0.0342252912802,0.0342252912802,0.157647663757,0.157647663757,0.157647663757,0.0571475626231,0.0571475626231,0.0571475626231,0.0571475626231,0.0571475626231,0.0571475626231,0.0571475626231,0.0571475626231,0.0571475626231,0.0571475626231,0.0571475626231,0.0571475626231,0.0571475626231,0.0571475626231,0.0571475626231,0.0571475626231,0.0571475626231,0.0571475626231,0.169031701974,0.169031701974,0.169031701974,0.169031701974,0.169031701974,0.169031701974,0.169031701974,0.169031701974,0.169031701974,0.169031701974,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.208679011484,0.682108720638,0.682108720638,0.682108720638,0.682108720638,0.682108720638,0.682108720638,0.682108720638)
L_mean=c(0.536840576019, 0.536840576019,0.536840576019,0.469225559526,0.469225559526,0.469225559526,0.282592552286,0.282592552286,0.282592552286,0.282592552286,0.282592552286,0.282592552286,0.282592552286,0.282592552286,0.282592552286,0.282592552286,0.282592552286,0.282592552286,0.282592552286,0.282592552286,0.282592552286,0.282592552286,0.282592552286,0.282592552286,0.287755596572,0.287755596572,0.287755596572,0.287755596572,0.287755596572,0.287755596572,0.287755596572,0.287755596572,0.287755596572,0.287755596572,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.359337935556,0.458549270041,0.458549270041,0.458549270041,0.458549270041,0.458549270041,0.458549270041,0.458549270041)
M_mean=c(0.584552842184, 0.584552842184,0.584552842184,0.398894200319,0.398894200319,0.398894200319,0.252274353307,0.252274353307,0.252274353307,0.252274353307,0.252274353307,0.252274353307,0.252274353307,0.252274353307,0.252274353307,0.252274353307,0.252274353307,0.252274353307,0.252274353307,0.252274353307,0.252274353307,0.252274353307,0.252274353307,0.252274353307,0.185537862038,0.185537862038,0.185537862038,0.185537862038,0.185537862038,0.185537862038,0.185537862038,0.185537862038,0.185537862038,0.185537862038,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.262440576683,0.238097244323,0.238097244323,0.238097244323,0.238097244323,0.238097244323,0.238097244323,0.238097244323)
R_mean=c(-0.0477122661652, -0.0477122661652,-0.0477122661652,0.0703313592065,0.0703313592065,0.0703313592065,0.0303181989795,0.0303181989795,0.0303181989795,0.0303181989795,0.0303181989795,0.0303181989795,0.0303181989795,0.0303181989795,0.0303181989795,0.0303181989795,0.0303181989795,0.0303181989795,0.0303181989795,0.0303181989795,0.0303181989795,0.0303181989795,0.0303181989795,0.0303181989795,0.102217734534,0.102217734534,0.102217734534,0.102217734534,0.102217734534,0.102217734534,0.102217734534,0.102217734534,0.102217734534,0.102217734534,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.096897358873,0.220452025718,0.220452025718,0.220452025718,0.220452025718,0.220452025718,0.220452025718,0.220452025718)
trans=0.5
age=(0:(64-1))* -1
plot(age,age,type = 'n', ylim = c(0, 0.906214218631), xlim = c(-67.2,3.2), ylab = 'Speciation rate', xlab = 'Ma',main='carnivora' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 0.707275673544), xlim = c(-67.2,3.2), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-0.148398679248, 0.750319592702), xlim = c(-67.2,3.2), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()