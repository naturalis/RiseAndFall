# 1 files combined:
# 	./primates_fossil_occurrences_1BD1-1_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./primates_fossil_occurrences_1BD1-1_marginal_rates_RTT.pdf',width=0.6*9, height=0.6*21)
par(mfrow=c(3,1))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
	N=100
	beta=(1:(N-1))/N
	alpha_shape=0.25
	cat=1-(beta^(1./alpha_shape))
	for (i in 1:(N-1)){
		trans= 1/N + 2/N
		polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
	}
	lines(rev(age), rev(mean_m), col = color, lwd=3)
}
	
L_hpd_m95=c(0.563137364939, 0.563137364939,0.563137364939,0.378384173385,0.378384173385,0.378384173385,0.344793069355,0.344793069355,0.344793069355,0.344793069355,0.344793069355,0.344793069355,0.344793069355,0.344793069355,0.344793069355,0.344793069355,0.344793069355,0.344793069355,0.344793069355,0.344793069355,0.344793069355,0.344793069355,0.344793069355,0.344793069355,0.113163262362,0.113163262362,0.113163262362,0.113163262362,0.113163262362,0.113163262362,0.113163262362,0.113163262362,0.113163262362,0.113163262362,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.231454928151,0.402142912276,0.402142912276,0.402142912276,0.402142912276,0.402142912276,0.402142912276,0.402142912276,0.402142912276)
L_hpd_M95=c(0.85427971753, 0.85427971753,0.85427971753,0.684448120185,0.684448120185,0.684448120185,0.474307989984,0.474307989984,0.474307989984,0.474307989984,0.474307989984,0.474307989984,0.474307989984,0.474307989984,0.474307989984,0.474307989984,0.474307989984,0.474307989984,0.474307989984,0.474307989984,0.474307989984,0.474307989984,0.474307989984,0.474307989984,0.233593542192,0.233593542192,0.233593542192,0.233593542192,0.233593542192,0.233593542192,0.233593542192,0.233593542192,0.233593542192,0.233593542192,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.298030213377,0.579901979845,0.579901979845,0.579901979845,0.579901979845,0.579901979845,0.579901979845,0.579901979845,0.579901979845)
M_hpd_m95=c(0.516640747498, 0.516640747498,0.516640747498,0.138865309543,0.138865309543,0.138865309543,0.313936395046,0.313936395046,0.313936395046,0.313936395046,0.313936395046,0.313936395046,0.313936395046,0.313936395046,0.313936395046,0.313936395046,0.313936395046,0.313936395046,0.313936395046,0.313936395046,0.313936395046,0.313936395046,0.313936395046,0.313936395046,0.20123588909,0.20123588909,0.20123588909,0.20123588909,0.20123588909,0.20123588909,0.20123588909,0.20123588909,0.20123588909,0.20123588909,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.248137456044,0.23425424536,0.23425424536,0.23425424536,0.23425424536,0.23425424536,0.23425424536,0.23425424536,0.23425424536)
M_hpd_M95=c(0.800395152052, 0.800395152052,0.800395152052,0.36050909753,0.36050909753,0.36050909753,0.439172509153,0.439172509153,0.439172509153,0.439172509153,0.439172509153,0.439172509153,0.439172509153,0.439172509153,0.439172509153,0.439172509153,0.439172509153,0.439172509153,0.439172509153,0.439172509153,0.439172509153,0.439172509153,0.439172509153,0.439172509153,0.366703812976,0.366703812976,0.366703812976,0.366703812976,0.366703812976,0.366703812976,0.366703812976,0.366703812976,0.366703812976,0.366703812976,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.318604837753,0.386900261553,0.386900261553,0.386900261553,0.386900261553,0.386900261553,0.386900261553,0.386900261553,0.386900261553)
R_hpd_m95=c(-0.16485699255, -0.16485699255,-0.16485699255,0.114164600189,0.114164600189,0.114164600189,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.0514931954764,-0.206574981989,-0.206574981989,-0.206574981989,-0.206574981989,-0.206574981989,-0.206574981989,-0.206574981989,-0.206574981989,-0.206574981989,-0.206574981989,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,-0.0625732925841,0.0607038546749,0.0607038546749,0.0607038546749,0.0607038546749,0.0607038546749,0.0607038546749,0.0607038546749,0.0607038546749)
R_hpd_M95=c(0.245457769538, 0.245457769538,0.245457769538,0.513393214751,0.513393214751,0.513393214751,0.127916658941,0.127916658941,0.127916658941,0.127916658941,0.127916658941,0.127916658941,0.127916658941,0.127916658941,0.127916658941,0.127916658941,0.127916658941,0.127916658941,0.127916658941,0.127916658941,0.127916658941,0.127916658941,0.127916658941,0.127916658941,-0.0155345439868,-0.0155345439868,-0.0155345439868,-0.0155345439868,-0.0155345439868,-0.0155345439868,-0.0155345439868,-0.0155345439868,-0.0155345439868,-0.0155345439868,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.027408266426,0.291578089487,0.291578089487,0.291578089487,0.291578089487,0.291578089487,0.291578089487,0.291578089487,0.291578089487)
L_mean=c(0.708612419608, 0.708612419608,0.708612419608,0.528713841037,0.528713841037,0.528713841037,0.412387493175,0.412387493175,0.412387493175,0.412387493175,0.412387493175,0.412387493175,0.412387493175,0.412387493175,0.412387493175,0.412387493175,0.412387493175,0.412387493175,0.412387493175,0.412387493175,0.412387493175,0.412387493175,0.412387493175,0.412387493175,0.174230750344,0.174230750344,0.174230750344,0.174230750344,0.174230750344,0.174230750344,0.174230750344,0.174230750344,0.174230750344,0.174230750344,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.264341569691,0.488341271615,0.488341271615,0.488341271615,0.488341271615,0.488341271615,0.488341271615,0.488341271615,0.488341271615)
M_mean=c(0.668026913873, 0.668026913873,0.668026913873,0.245130299149,0.245130299149,0.245130299149,0.369254022944,0.369254022944,0.369254022944,0.369254022944,0.369254022944,0.369254022944,0.369254022944,0.369254022944,0.369254022944,0.369254022944,0.369254022944,0.369254022944,0.369254022944,0.369254022944,0.369254022944,0.369254022944,0.369254022944,0.369254022944,0.286465533121,0.286465533121,0.286465533121,0.286465533121,0.286465533121,0.286465533121,0.286465533121,0.286465533121,0.286465533121,0.286465533121,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.282639799418,0.30894829224,0.30894829224,0.30894829224,0.30894829224,0.30894829224,0.30894829224,0.30894829224,0.30894829224)
R_mean=c(0.0405855057352, 0.0405855057352,0.0405855057352,0.283583541888,0.283583541888,0.283583541888,0.0431334702313,0.0431334702313,0.0431334702313,0.0431334702313,0.0431334702313,0.0431334702313,0.0431334702313,0.0431334702313,0.0431334702313,0.0431334702313,0.0431334702313,0.0431334702313,0.0431334702313,0.0431334702313,0.0431334702313,0.0431334702313,0.0431334702313,0.0431334702313,-0.112234782778,-0.112234782778,-0.112234782778,-0.112234782778,-0.112234782778,-0.112234782778,-0.112234782778,-0.112234782778,-0.112234782778,-0.112234782778,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,-0.0182982297267,0.179392979375,0.179392979375,0.179392979375,0.179392979375,0.179392979375,0.179392979375,0.179392979375,0.179392979375)
trans=0.5
age=(0:(65-1))* -1
plot(age,age,type = 'n', ylim = c(0, 0.939707689283), xlim = c(-68.25,3.25), ylab = 'Speciation rate', xlab = 'Ma',main='primates' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 0.880434667257), xlim = c(-68.25,3.25), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-0.227232480188, 0.564732536226), xlim = c(-68.25,3.25), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()